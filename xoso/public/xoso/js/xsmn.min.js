xsmn={is_alert:!1,load_type:"html",recent_load:0,now:0},xsmn.init=function(){$.datepicker.setDefaults($.datepicker.regional.vn),$(".has_date_picker").datepicker({dateFormat:"dd-mm-yy",changeMonth:!0,changeYear:!0,showAnim:"fold",buttonText:!1,yearRange:"2002:c+1"})},xsmn.load=function(t,a,n,e,i,s,o,r){xsmn.is_alert=s,xsmn.load_type=o,r&&(xsmn.recent_load=1e3*(r-3600));(new Date).getTime();$(document).ready(function(){xsmn.loadMiennam(a,e),interval=setInterval(function(){xsmn.loadMiennam(a,e)},1500)})},xsmn.isIe=function(){var t=!1,a=window.navigator.userAgent,n=a.indexOf("MSIE "),e=a.indexOf("Trident/");return(n>-1||e>-1)&&(t=!0),t},xsmn.loadKetquaMiennam=function(t,a){$.ajax({type:"GET",url:t,data:{},beforeSend:function(){},error:function(t,a){},success:function(t){if(""!=t)if("json"==xsmn.load_type){var n=JSON.parse(t);xsmn.generateHtml(n,a)}else xsmn.remainInBlock(a)>(t.match(/imgloadig/g)||[]).length?(html=$.parseHTML(t),$(a+" #kq").replaceWith(html[0]),$(a+" #dd").replaceWith(html[4]),1==xsmn.is_alert&&xsmn.alertToApp()):console.log("too slow, donot update")}})},xsmn.loadMiennam=function(t,a){var n=new Date;if(n.getMinutes()>10&&xsmn.isAllowLoad(a)){var e=xsmn.getStaticUrl(t)+"?t="+n.getTime();xsmn.loadKetquaMiennam(e,a)}},xsmn.goToDate=function(t,a,n,e){$.ajax({type:"POST",url:"/ajax/get-url-by-date",data:{date:t,action:a,province_code:n,province_name:e},success:function(t){result=JSON.parse(t),0==result.error&&(window.location.href=result.url)}})},xsmn.initSearch=function(t,a,n){$.datepicker.setDefaults($.datepicker.regional.vn),$("#searchDate").datepicker({dateFormat:"dd-mm-yy",changeMonth:!0,changeYear:!0,showAnim:"fold",buttonText:!1,yearRange:"2002:"+((new Date).getFullYear()+1)})},xsmn.getStaticUrl=function(t){return id=Math.floor(100*Math.random()),id1=7,id<5?id1=1:id>=5&&id<10?id1=2:id>=10&&id<15?id1=3:id>=15&&id<38?id1=4:id>=38&&id<58?id1=5:id>=58&&id<76&&(id1=6),7==id1?"http://210.211.97.12"+t:"http://dev"+id1+".xoso.me"+t},xsmn.getWsUrl=function(t){return port=8080,id=Math.floor(8*Math.random()),0==id?t="ws://dev.xoso.me":1==id?t="ws://dev1.xoso.me":3==id?(t="ws://dev3.xoso.me",port=8082):4==id?t="ws://dev4.xoso.me":5==id&&(t="ws://dev5.xoso.me"),console.log(t+":"+port),t+":"+port},xsmn.remainInBlock=function(t){return $(t+" .imgloadig").length},xsmn.isAllowLoad=function(t){return $(t+" .imgloadig").length>0||$(t+" .imgloadig").length>0},xsmn.alertToApp=function(){window.location="app:webToNativeCall"},xsmn.generateHtml=function(t,a){var n="",e="",i=!1;t.hasOwnProperty("lotData")?xsmn.recent_load<t.resultDate&&(xsmn.recent_load=t.resultDate,i=!0,"MB"==t.provinceCode?(n=xsmn.drawMb(t),e=xsmn.drawMbLoto(t)):(n=xsmn.drawProvince(t),e=xsmn.drawMbLoto(t))):xsmn.recent_load<t[0].resultDate&&(i=!0,xsmn.recent_load=t[0].resultDate,n=xsmn.drawRegion(t),e=xsmn.drawRegionLoto(t)),i?($(a+" #kq table tbody").replaceWith(n),$(a+" #dd").replaceWith(e),xsmn.refreshCtrlPanel(document.querySelector(a+" #kq table")),console.log("updated")):console.log("dont update")},xsmn.getLastValProvince=function(t){for(var a="",n=8;n>0;n--)t[n].forEach(function(t){a=""!=t?t:a});if(""==(a=""!=t.DB?t.DB:a))return t;var e={};t.DB==a?(e.DB=['<span class="clnote">'+t.DB+"</span>"],a=""):e.DB=t.DB;for(n=1;n<9;n++)e[n]=[],t[n].forEach(function(t){t.trim()==a.trim()&&(t='<span class="clnote">'+t+"</span>"),e[n].push(t)});return e},xsmn.getLastValMb=function(t){for(var a="",n=1;n<8;n++)t[n].forEach(function(t){a=""!=t?t:a});if(""==(a=""!=t.DB?t.DB:a))return t;var e={};t.DB==a?(e.DB=['<span class="clnote">'+t.DB+"</span>"],a=""):e.DB=t.DB;for(n=7;n>0;n--)e[n]=[],t[n].forEach(function(t){t.trim()==a.trim()&&(t='<span class="clnote">'+t+"</span>"),e[n].push(t)});return e},xsmn.drawMb=function(t){var a=t.lotData;a=xsmn.getLastValMb(a);var n="<tbody>";return n+="<tr class='db'><td class='txt-giai'>Đặc biệt</td><td colspan='12' class='number'><b"+(""==a.DB?" class='imgloadig'>":">"+a.DB)+"</b></td></tr>",n+="<tr class='bg_f6'><td class='txt-giai'>Giải nhất</td><td colspan='12' class='number'><b"+(""==a[1]?" class='imgloadig'>":">"+a[1])+"</b></td></tr>",n+="<tr><td class='txt-giai'>Giải nhì </td>",a[2].forEach(function(t){n+="<td colspan='6' class='number'><b"+(""==t?" class='imgloadig'>":">"+t)+"</b></td>"}),n+="</tr><tr class='giai3 bg_ef'><td class='txt-giai' rowspan='2'>Giải ba</td>",a[3].slice(0,3).forEach(function(t){n+="<td class='number' colspan='4'><b"+(""==t?" class='imgloadig'>":">"+t)+"</b></td>"}),n+="</tr><tr class='bg_ef'>",a[3].slice(3,6).forEach(function(t){n+="<td class='number' colspan='4'><b"+(""==t?" class='imgloadig'>":">"+t)+"</b></td>"}),n+="</tr><tr><td class='txt-giai'>Giải tư</td>",a[4].forEach(function(t){n+="<td class='number' colspan='3'><b"+(""==t?" class='imgloadig'>":">"+t)+"</b></td>"}),n+="</tr><tr class='giai5 bg_ef'><td class='txt-giai' rowspan='2'>Giải năm</td>",a[5].slice(0,3).forEach(function(t){n+="<td class='number' colspan='4'><b"+(""==t?" class='imgloadig'>":">"+t)+"</b></td>"}),n+="</tr><tr class='bg_ef'>",a[5].slice(3,6).forEach(function(t){n+="<td class='number' colspan='4'><b"+(""==t?" class='imgloadig'>":">"+t)+"</b></td>"}),n+="</tr><tr><td class='txt-giai'>Giải sáu</td>",a[6].forEach(function(t){n+="<td class='number' colspan='4'><b"+(""==t?" class='imgloadig'>":">"+t)+"</b></td>"}),n+="</tr><tr class='bg_ef'><td class='txt-giai'>Giải bảy</td>",a[7].forEach(function(t){n+="<td class='number' colspan='3'><b"+(""==t?" class='imgloadig'>":">"+t)+"</b></td>"}),n+="</tr></tbody>"},xsmn.drawMbLoto=function(t){for(var a=t.lotData.DB+"",n=""==a?"":a.slice(-2),e=""==n?"":n.slice(-1),i="<div id='dd' class='col-firstlast'><table class='firstlast-mb fl' border='0' cellpadding='0' cellspacing='0'><tbody><tr class='header'><th>Đầu</th><th>Đuôi</th></tr>",s=0;s<10;s++){i+="<tr><td><b class='clnote'>"+s+"</b></td><td>";var o="";t.dau[s].forEach(function(t){o+=","+(""!=t&&t==e&&s==n?"<span class='clnote'>"+t+"</span>":t)}),i+=(""!=o?o.substring(1):"")+"</td></tr>"}i+="</tbody></table><table cellspacing='0' cellpadding='0' border='0' class='firstlast-mb fr'><tbody><tr class='header'><th>Đầu</th><th>Đuôi</th></tr>";for(s=0;s<10;s++){i+="<tr><td>";o="";t.duoi[s+""].forEach(function(t){o+=","+(""!=t&&t==n&&s==e?"<span class='clnote'>"+t+"</span>":t)}),i+=(""!=o?o.substring(1):"")+"</td><td><b class='clnote'>"+s+"</b></td></tr>"}return i+="</tbody></table></div>"},xsmn.drawProvince=function(t){var a=t.lotData;a=xsmn.getLastValProvince(a);var n="<tbody>";return n+="<tr class='giai8'><td class='txt-giai'>Giải tám</td><td colspan='12' class='number'><b"+(""==a[8]?" class='imgloadig'>":">"+a[8])+"</b></td></tr>",n+="<tr class='bg_ef'><td class='txt-giai'>Giải bảy</td><td colspan='12' class='number'><b"+(""==a[7]?" class='imgloadig'>":">"+a[7])+"</b></td></tr>",n+="<tr><td class='txt-giai'>Giải sáu</td>",a[6].forEach(function(t){n+="<td colspan='4' class='number'><b"+(""==t?" class='imgloadig'>":">"+t)+"</b></td>"}),n+="</tr><tr class='bg_ef'><td class='txt-giai'>Giải năm</td><td colspan='12' class='number'><b"+(""==a[5]?" class='imgloadig'>":">"+a[5])+"</b></td></tr>",n+="</tr><tr class='giai4'><td rowspan='2' class='txt-giai'>Giải bốn</td>",a[4].slice(0,4).forEach(function(t){n+="<td class='number' colspan='3'><b"+(""==t?" class='imgloadig'>":">"+t)+"</b></td>"}),n+="</tr><tr>",a[4].slice(4,7).forEach(function(t){n+="<td class='number' colspan='4'><b"+(""==t?" class='imgloadig'>":">"+t)+"</b></td>"}),n+="</tr><tr class='bg_ef'><td class='txt-giai'>Giải ba</td>",a[3].forEach(function(t){n+="<td class='number' colspan='6'><b"+(""==t?" class='imgloadig'>":">"+t)+"</b></td>"}),n+="</tr><tr><td class='txt-giai'>Giải nhì</td><td colspan='12' class='number'><b"+(""==a[2]?" class='imgloadig'>":">"+a[2])+"</b></td></tr>",n+="<tr class='bg_ef'><td class='txt-giai'>Giải nhất</td><td colspan='12' class='number'><b"+(""==a[1]?" class='imgloadig'>":">"+a[1])+"</b></td></tr>",n+="<tr class='db'><td class='txt-giai'>Đặc biệt</td><td colspan='12' class='number'><b"+(""==a.DB?" class='imgloadig'>":">"+a.DB)+"</b></td></tr>",n+="</tbody>"},xsmn.drawRegion=function(t){for(var a=Object.keys(t).length,n=0;n<a;n++)t[n].lotData=xsmn.getLastValProvince(t[n].lotData);var e="<tbody><tr class='gr-yellow'><th class='first'></th>";return t.forEach(function(t){e+="<th><b>"+t.provinceName+"</b><br /><span class='s12'>Mã: "+t.provinceCode+"</span></th>"}),e+="</tr><tr class='g8'><td>G8</td>",t.forEach(function(t){e+="<td><div"+(""==t.lotData[8]?" class='imgloadig'>":">"+t.lotData[8])+"</div></td>"}),e+="</tr><tr><td>G7</td>",t.forEach(function(t){e+="<td><div"+(""==t.lotData[7]?" class='imgloadig'>":">"+t.lotData[7])+"</div></td>"}),e+="</tr><tr><td>G6</td>",t.forEach(function(t){e+="<td>",t.lotData[6].forEach(function(t){e+="<div"+(""==t?" class='imgloadig'>":">"+t)+"</div>"}),e+="</td>"}),e+="</tr><tr><td>G5</td>",t.forEach(function(t){e+="<td><div"+(""==t.lotData[5]?" class='imgloadig'>":">"+t.lotData[5])+"</div></td>"}),e+="</tr><tr><td>G4</td>",t.forEach(function(t){e+="<td>",t.lotData[4].forEach(function(t){e+="<div"+(""==t?" class='imgloadig'>":">"+t)+"</div>"}),e+="</td>"}),e+="</tr><tr><td>G3</td>",t.forEach(function(t){e+="<td>",t.lotData[3].forEach(function(t){e+="<div"+(""==t?" class='imgloadig'>":">"+t)+"</div>"}),e+="</td>"}),e+="</tr><tr><td>G2</td>",t.forEach(function(t){e+="<td><div"+(""==t.lotData[2]?" class='imgloadig'>":">"+t.lotData[2])+"</div></td>"}),e+="</tr><tr><td>G1</td>",t.forEach(function(t){e+="<td><div"+(""==t.lotData[1]?" class='imgloadig'>":">"+t.lotData[1])+"</div></td>"}),e+="</tr><tr class='gdb'><td>DB</td>",t.forEach(function(t){e+="<td><div"+(""==t.lotData.DB?" class='imgloadig'>":">"+t.lotData.DB)+"</div></td>"}),e+="</tr></tbody>"},xsmn.drawRegionLoto=function(t){var a=Object.keys(t).length,n="<div id='dd' class='col-firstlast col"+(2==a?"two":3==a?"three":"four")+"city colgiai'><table class='firstlast-mn' border='0' width='100%' cellpadding='0' cellspacing='0'><tbody><tr class='header'><th width='10%' class='first'>Đầu</th>";t.forEach(function(t){n+="<th>"+t.provinceName+"</th>"});for(var e=0;e<10;e++)n+="</tr><tr><td><b class='clnote'>"+e+"</b></td>",t.forEach(function(t){var a="";t.dau[e].forEach(function(t){a+=","+t}),n+="<td>"+(""!=a?a.substring(1):"")+"</td>"});return n+="</tr></tbody></table></div>"},xsmn.track=function(t,a,n){$.ajax({type:"POST",url:"/tracking/index",data:{objType:t,id:a,actionType:n},error:function(t,a){},success:function(t){}})},xsmn.addTableCtrlPanel=function(t,a){function n(t,a,n){var e=document.createElement(t.toUpperCase());if("string"==typeof a)e.className=a;else if("object"==typeof a){var i;for(i in a)a.hasOwnProperty(i)&&e.setAttribute(i,a[i])}return"string"==typeof n?e.innerHTML=n:n instanceof HTMLElement?e.appendChild(n):n instanceof Array&&function(t,a){if(!(a instanceof Array))throw TypeError();a.forEach(function(a){"string"==typeof a?t.innerHTML+=a:a instanceof HTMLElement&&t.appendChild(a)})}(e,n),e}[].forEach.call(t,function(t){var e=n("CAPTION","title",t.getAttribute("data-title")||""),i=n("SPAN","zoom-in-button",[n("I","icon zoom-in-icon"),n("SPAN")]),s=n("DIV","buttons-wrapper",[i,n("SPAN","share-button",[n("I","icon share-icon"),n("SPAN")])]),o=n("FORM","digits-form"),r=a(t);[].forEach.call(r,function(t){t.children[0]||(t.number=t.innerHTML)}),void 0===t.showedDigits&&(t.showedDigits=0),[0,2,3].forEach(function(a){var e=n("INPUT",{type:"radio",name:"showed-digits",value:a});a===t.showedDigits&&(e.checked=!0);var i=n("LABEL",{class:"radio","data-value":a},[e,n("B"),n("SPAN")]);function s(){[].forEach.call(r,function(a){a.number&&(a.innerHTML=a.number.slice(-t.showedDigits))})}e.onchange=function(){!0===e.checked&&(t.showedDigits=a,s()),parentId=t.parentNode.parentNode.getAttribute("id"),ga("send","event",parentId+":"+a,"click","xem n so cuoi")},s(),o.appendChild(i)});var l=n("DIV","control-panel",[o,s]);t.parentNode.insertBefore(l,t.nextElementSibling),t.ctrlPanel=l;var c=n("SPAN","zoom-out-button",n("I","icon zoom-out-icon")),d=function(){var a=t.clientWidth,n=t.clientHeight,e=window.innerWidth,i=window.innerHeight;t.style.transform="scale("+e/a+","+i/n+")"};i.onclick=function(){t.insertBefore(e,t.firstChild),t.classList.add("full-screen"),e.appendChild(c),d(),window.addEventListener("resize",d),t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen(),ga("send","event","zoom-in-btn","click","phong to")},c.onclick=function(){t.removeChild(e),t.classList.remove("full-screen"),t.style.transform="",window.removeEventListener("resize",d),e.removeChild(c),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}})},xsmn.removeTableCtrlPanel=function(t){[].forEach.call(t,function(t){t.ctrlPanel&&t.ctrlPanel.parentNode.removeChild(t.ctrlPanel)})},xsmn.refreshCtrlPanel=function(t){xsmn.removeTableCtrlPanel([t]),xsmn.addTableCtrlPanel([t],function(t){return[].filter.call(t.querySelectorAll("td, td *"),function(t){return!isNaN(t.innerHTML)})})},xsmn.addTableCtrlPanel(function(){var t=document.querySelectorAll("table.extendable");return[].forEach.call(t,function(t){t.showedDigits=0}),t}(),function(t){return[].filter.call(t.querySelectorAll("td, td *"),function(t){return!isNaN(t.innerHTML)})});